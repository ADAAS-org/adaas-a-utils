{"version":3,"sources":["../../../../../src/lib/A-Signal/context/A-SignalState.context.ts"],"names":[],"mappings":"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","file":"A-SignalState.context.mjs","sourcesContent":["import { A_Context, A_Fragment, A_TYPES__Component_Constructor } from \"@adaas/a-concept\";\nimport { A_Signal } from \"../entities/A-Signal.entity\";\nimport { A_SignalVector } from \"../entities/A-SignalVector.entity\";\nimport { A_Frame } from \"@adaas/a-frame\";\n\n/**\n * A_SignalState manages the latest state of all signals within a given scope.\n * \n * This class maintains a mapping between signal constructors and their most recently emitted values,\n * providing a centralized state store for signal management within an application context.\n * \n * @template TSignalData - Union type of all possible signal data types that can be stored (must extend Record<string, any>)\n * \n * The generic ensures type safety by maintaining correspondence between:\n * - Signal constructor types and their data types\n * - Signal instances and their emitted value types\n * - Vector structure and the data it contains\n */\n@A_Frame.Fragment({\n    namespace: 'A-Utils',\n    name: 'A-SignalState',\n    description: 'Manages the latest state of all signals within a given scope, maintaining a mapping between signal constructors and their most recently emitted values.'\n})\nexport class A_SignalState<\n    TSignalData extends Record<string, any> = Record<string, any>\n> extends A_Fragment {\n\n    /**\n     * Internal map storing the relationship between signal constructors and their latest values\n     * Key: Signal constructor function\n     * Value: Latest emitted data from that signal type\n     */\n    protected _state: Map<A_TYPES__Component_Constructor<A_Signal>, A_Signal> = new Map();\n\n    /**\n     * Previous state map to track changes between signal emissions\n     * Key: Signal constructor function\n     * Value: Previous emitted data from that signal type\n     */\n    protected _prevState: Map<A_TYPES__Component_Constructor<A_Signal>, A_Signal> = new Map();\n\n    /**\n     * Optional structure defining the ordered list of signal constructors\n     * Used for vector operations and initialization\n     */\n    protected _structure: Array<A_TYPES__Component_Constructor<A_Signal>>;\n\n\n    /**\n     * Gets the ordered structure of signal constructors\n     * @returns Array of signal constructors in their defined order\n     */\n    get structure(): Array<A_TYPES__Component_Constructor<A_Signal>> {\n        return this._structure || [];\n    }\n\n    /**\n     * Creates a new A_SignalState instance\n     * \n     * @param structure - Optional array defining the ordered structure of signal constructors\n     *                   This structure is used for vector operations and determines the order\n     *                   in which signals are processed and serialized\n     */\n    constructor(\n        structure: A_TYPES__Component_Constructor<A_Signal>[]\n    ) {\n        super({ name: \"A_SignalState\" });\n\n        this._structure = structure;\n\n        // Initialize the state map with undefined values for each signal in the structure\n        // This ensures all expected signals have entries in the state map from the start\n      \n    }\n\n\n    /**\n     * Sets the latest value for a specific signal type\n     * \n     * @param signal - The signal constructor to associate the value with\n     * @param value - The data value emitted by the signal\n     */\n    set(\n        signal: A_Signal,\n        value: A_Signal\n    ): void\n    set(\n        signal: A_Signal\n    ): void\n    set(\n        signal: A_TYPES__Component_Constructor<A_Signal>,\n        value: A_Signal\n    ): void\n    set(\n        param1: A_TYPES__Component_Constructor<A_Signal> | A_Signal,\n        param2?: A_Signal\n    ): void {\n        const signal = param1 instanceof A_Signal ? param1.constructor as A_TYPES__Component_Constructor<A_Signal> : param1;\n        const value = param1 instanceof A_Signal ? param1 : param2!;\n\n        this._prevState.set(signal, this._state.get(signal)!);\n        this._state.set(signal, value);\n    }\n\n    /**\n     * Retrieves the latest value for a specific signal type\n     * \n     * @param signal - The signal constructor to get the value for\n     * @returns The latest data value or undefined if no value has been set\n     */\n    get(\n        signal: A_Signal\n    ): A_Signal | undefined\n    get(\n        signal: A_TYPES__Component_Constructor<A_Signal>\n    ): A_Signal | undefined\n    get(\n        param: A_TYPES__Component_Constructor<A_Signal> | A_Signal\n    ): A_Signal | undefined {\n        const signal = param instanceof A_Signal ? param.constructor as A_TYPES__Component_Constructor<A_Signal> : param;\n        return this._state.get(signal);\n    }\n\n    /**\n     * Retrieves the previous value for a specific signal type\n     * \n     * @param signal \n     */\n    getPrev(\n        signal: A_Signal\n    ): A_Signal | undefined\n    getPrev(\n        signal: A_TYPES__Component_Constructor<A_Signal>\n    ): A_Signal | undefined\n    getPrev(\n        param: A_TYPES__Component_Constructor<A_Signal> | A_Signal\n    ): A_Signal | undefined {\n        const signal = param instanceof A_Signal ? param.constructor as A_TYPES__Component_Constructor<A_Signal> : param;\n        return this._prevState.get(signal);\n    }   \n\n    /**\n     * Checks if a signal type has been registered in the state\n     * \n     * @param signal - The signal constructor to check for\n     * @returns True if the signal type exists in the state map\n     */\n    has(\n        signal: A_Signal\n    ): boolean\n    has(\n        signal: A_TYPES__Component_Constructor<A_Signal>\n    ): boolean\n    has(\n        param: A_TYPES__Component_Constructor<A_Signal> | A_Signal\n    ): boolean {\n        const signal = param instanceof A_Signal ? param.constructor as A_TYPES__Component_Constructor<A_Signal> : param;\n\n        return this.structure.includes(signal);\n    }\n\n    /**\n     * Removes a signal type and its associated value from the state\n     * \n     * @param signal - The signal constructor to remove\n     * @returns True if the signal was successfully deleted, false if it didn't exist\n     */\n    delete(\n        signal: A_Signal\n    ): boolean\n    delete(\n        signal: A_TYPES__Component_Constructor<A_Signal>\n    ): boolean\n    delete(\n        param: A_TYPES__Component_Constructor<A_Signal> | A_Signal\n    ): boolean {\n        const signal = param instanceof A_Signal ? param.constructor as A_TYPES__Component_Constructor<A_Signal> : param;\n        return this._state.delete(signal);\n    }\n\n\n    /**\n     * Converts the current state to a vector (ordered array) format\n     * \n     * The order is determined by the structure array provided during construction.\n     * Each position in the vector corresponds to a specific signal type's latest value.\n     * \n     * @returns Array of signal values in the order defined by the structure\n     * @throws Error if structure is not defined or if any signal value is undefined\n     */\n    toVector(): A_SignalVector {\n        const vector: Array<A_Signal> = [];\n\n        this._state.forEach((value, key) => {\n            vector.push(value);\n        });\n\n        return new A_SignalVector(vector, this.structure);\n    }\n\n    /**\n     * Converts the current state to an object with signal constructor names as keys\n     * \n     * This provides a more readable representation of the state where each signal\n     * type is identified by its constructor name.\n     * \n     * @returns Object mapping signal constructor names to their latest values\n     * @throws Error if any signal value is undefined\n     */\n    toObject(): Record<string, A_Signal> {\n        const obj: Record<string, A_Signal> = {};\n\n        this.structure.forEach((signalConstructor) => {\n            const value = this._state.get(signalConstructor);\n            if (value === undefined) {\n                throw new Error(`Signal ${signalConstructor.name} has no value in state`);\n            }\n            obj[signalConstructor.name] = value;\n        });\n\n        return obj;\n    }\n\n}"]}