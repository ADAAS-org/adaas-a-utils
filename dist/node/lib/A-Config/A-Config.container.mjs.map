{"version":3,"sources":["../../../../src/lib/A-Config/A-Config.container.ts"],"names":[],"mappings":";;;;;;;;;;AAgBO,IAAM,cAAA,GAAN,cAA6B,WAAA,CAAY;AAAA,EAQ5C,MAAM,QACoB,QAAA,EACxB;AACE,IAAA,IAAI,CAAC,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,QAAQ,CAAA,EAAG;AAC3B,MAAA,MAAM,SAAA,GAAY,IAAI,QAAA,CAAS;AAAA,QAC3B,SAAA,EAAW;AAAA,UACP,GAAG,wCAAA;AAAA,UACH,GAAG;AAAA,SACP;AAAA,QACA,UAAU;AAAC,OACd,CAAA;AAED,MAAA,IAAA,CAAK,KAAA,CAAM,SAAqB,SAAS,CAAA;AAAA,IAC7C;AAGA,IAAA,MAAM,EAAA,GAAK,MAAM,QAAA,CAAS,EAAA,EAAG;AAE7B,IAAA,IAAI;AACA,MAAA,QAAQ,IAAA;AAAM,QAEV,MAAK,SAAA,CAAU,WAAA,KAAgB,QAAA,IAAY,CAAC,CAAC,EAAA,CAAG,UAAA,CAAW,CAAA,EAAG,SAAA,CAAU,OAAO,CAAA,UAAA,CAAY,CAAA;AACvF,UAAA,IAAA,CAAK,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,OAAA,CAAsB,gBAAgB,CAAA;AAC/D,UAAA;AAAA,QAEJ,MAAK,SAAA,CAAU,WAAA,KAAgB,QAAA,IAAY,CAAC,GAAG,UAAA,CAAW,CAAA,EAAG,SAAA,CAAU,OAAO,CAAA,UAAA,CAAY,CAAA;AACtF,UAAA,IAAA,CAAK,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,OAAA,CAAsB,eAAe,CAAA;AAC9D,UAAA;AAAA,QAEJ,KAAK,UAAU,WAAA,KAAgB,SAAA;AAC3B,UAAA,IAAA,CAAK,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,OAAA,CAAsB,eAAe,CAAA;AAC9D,UAAA;AAAA,QAEJ;AACI,UAAA,MAAM,IAAI,aAAA;AAAA,YACN,aAAA,CAAc,mBAAA;AAAA,YACd,CAAA,YAAA,EAAe,UAAU,WAAW,CAAA,iBAAA;AAAA,WACxC;AAAA;AACR,IACJ,SAAS,KAAA,EAAO;AACZ,MAAA,IAAI,iBAAiB,YAAA,EAAc;AAC/B,QAAA,MAAM,IAAI,aAAA,CAAc;AAAA,UACpB,OAAO,aAAA,CAAc,mBAAA;AAAA,UACrB,WAAA,EAAa,CAAA,sEAAA,EAAyE,SAAA,CAAU,WAAW,CAAA,CAAA;AAAA,UAC3G,aAAA,EAAe;AAAA,SAClB,CAAA;AAAA,MACL;AAAA,IACJ;AAAA,EACJ;AACJ;AAjDU,eAAA,CAAA;AAAA,EAHL,UAAU,IAAA,CAAK;AAAA,IACZ,MAAA,EAAQ;AAAA,GACX,CAAA;AAAA,EAEI,4BAAS,UAAU,CAAA;AAAA,CAAA,EATf,cAAA,CAQH,SAAA,EAAA,SAAA,EAAA,CAAA,CAAA;AARG,cAAA,GAAN,eAAA,CAAA;AAAA,EALN,QAAQ,SAAA,CAAU;AAAA,IACf,SAAA,EAAW,SAAA;AAAA,IACX,IAAA,EAAM,gBAAA;AAAA,IACN,WAAA,EAAa;AAAA,GAChB;AAAA,CAAA,EACY,cAAA,CAAA","file":"A-Config.container.mjs","sourcesContent":["import {  A_Concept, A_CONSTANTS__DEFAULT_ENV_VARIABLES_ARRAY, A_Container, A_Context, A_Fragment, A_Inject, A_Scope, A_ScopeError } from \"@adaas/a-concept\";\nimport { ConfigReader } from \"./components/ConfigReader.component\";\nimport { A_Config } from \"./A-Config.context\";\nimport { A_ConfigError } from \"./A-Config.error\";\nimport { FileConfigReader } from \"./components/FileConfigReader.component\";\nimport { ENVConfigReader } from \"./components/ENVConfigReader.component\";\nimport { A_CONSTANTS__CONFIG_ENV_VARIABLES_ARRAY } from \"./A-Config.constants\";\nimport { A_Frame } from \"@adaas/a-frame\";\nimport { A_Polyfill } from \"@adaas/a-utils/a-polyfill\"\n\n\n@A_Frame.Container({\n    namespace: 'A-Utils',\n    name: 'A-ConfigLoader',\n    description: 'Container responsible for loading and initializing the A_Config component based on the environment and available configuration sources. It can be useful for application that need a separated configuration management and sharable across multiple containers.'\n})\nexport class A_ConfigLoader extends A_Container {\n\n    private reader!: ConfigReader\n\n\n    @A_Concept.Load({\n        before: /.*/\n    })\n    async prepare(\n        @A_Inject(A_Polyfill) polyfill: A_Polyfill,\n    ) {\n        if (!this.scope.has(A_Config)) {\n            const newConfig = new A_Config({\n                variables: [\n                    ...A_CONSTANTS__DEFAULT_ENV_VARIABLES_ARRAY,\n                    ...A_CONSTANTS__CONFIG_ENV_VARIABLES_ARRAY\n                ] as const,\n                defaults: {}\n            });\n\n            this.scope.register<A_Fragment>(newConfig);\n        }\n\n\n        const fs = await polyfill.fs();\n\n        try {\n            switch (true) {\n\n                case A_Context.environment === 'server' && !!fs.existsSync(`${A_Context.concept}.conf.json`):\n                    this.reader = this.scope.resolve<ConfigReader>(FileConfigReader)!;\n                    break;\n\n                case A_Context.environment === 'server' && !fs.existsSync(`${A_Context.concept}.conf.json`):\n                    this.reader = this.scope.resolve<ConfigReader>(ENVConfigReader)!;\n                    break;\n\n                case A_Context.environment === 'browser':\n                    this.reader = this.scope.resolve<ConfigReader>(ENVConfigReader)!;\n                    break;\n\n                default:\n                    throw new A_ConfigError(\n                        A_ConfigError.InitializationError,\n                        `Environment ${A_Context.environment} is not supported`\n                    );\n            }\n        } catch (error) {\n            if (error instanceof A_ScopeError) {\n                throw new A_ConfigError({\n                    title: A_ConfigError.InitializationError,\n                    description: `Failed to initialize A_ConfigLoader. Reader not found for environment ${A_Context.environment}`,\n                    originalError: error,\n                })\n            }\n        }\n    }\n}"]}